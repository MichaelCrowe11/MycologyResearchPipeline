{% extends "base.html" %}

{% block title %}3D Molecular Viewer - Mycology Research Pipeline{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">3D Molecular Visualization</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-eye me-1"></i> Sample Molecules
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('psilocybin')">Psilocybin</a></li>
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('psilocin')">Psilocin</a></li>
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('ergotamine')">Ergotamine</a></li>
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('betulinic_acid')">Betulinic Acid</a></li>
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('ganoderic_acid')">Ganoderic Acid</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="loadMolecule('custom')">Load Custom Molecule</a></li>
            </ul>
        </div>
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-palette me-1"></i> Style
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="setStyle('stick')">Stick</a></li>
                <li><a class="dropdown-item" href="#" onclick="setStyle('sphere')">Sphere</a></li>
                <li><a class="dropdown-item" href="#" onclick="setStyle('cartoon')">Cartoon</a></li>
                <li><a class="dropdown-item" href="#" onclick="setStyle('line')">Line</a></li>
                <li><a class="dropdown-item" href="#" onclick="setStyle('cross')">Cross</a></li>
            </ul>
        </div>
        <button type="button" class="btn btn-sm btn-outline-primary" id="fullscreenBtn">
            <i class="fas fa-expand me-1"></i> Fullscreen
        </button>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="molecule-title">Molecular Viewer</h5>
                <div class="spinner-border spinner-border-sm text-primary d-none" id="loading-spinner" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            <div class="card-body p-0">
                <!-- 3D Molecular Viewer Container -->
                <div id="molecule-viewer" style="height: 500px; width: 100%; position: relative;"></div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">
                <h5 class="mb-0">Molecule Information</h5>
            </div>
            <div class="card-body">
                <div id="molecule-info">
                    <p class="text-center text-muted">Select a molecule to view information</p>
                </div>
                
                <hr>
                
                <h6>Visualization Controls</h6>
                <div class="mb-3">
                    <label for="backgroundColorPicker" class="form-label">Background Color</label>
                    <input type="color" class="form-control form-control-color" id="backgroundColorPicker" value="#ffffff" title="Choose background color">
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="showLabelsSwitch" checked>
                    <label class="form-check-label" for="showLabelsSwitch">Show Atom Labels</label>
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="spinSwitch">
                    <label class="form-check-label" for="spinSwitch">Spin Model</label>
                </div>
                
                <button type="button" class="btn btn-outline-secondary w-100 mb-2" id="resetViewBtn">
                    <i class="fas fa-sync-alt me-1"></i> Reset View
                </button>
                
                <button type="button" class="btn btn-outline-primary w-100" id="downloadImgBtn">
                    <i class="fas fa-download me-1"></i> Download Image
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Custom Molecule Input</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="moleculeFormat" class="form-label">Input Format</label>
                    <select class="form-select" id="moleculeFormat">
                        <option value="pdb">PDB</option>
                        <option value="mol2">MOL2</option>
                        <option value="sdf">SDF/MOL</option>
                        <option value="xyz">XYZ</option>
                        <option value="pqr">PQR</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="moleculeInput" class="form-label">Molecule Data</label>
                    <textarea class="form-control font-monospace" id="moleculeInput" rows="8" placeholder="Paste PDB, MOL2, SDF, XYZ or PQR data here..."></textarea>
                </div>
                
                <div class="mb-3">
                    <label for="moleculePdbId" class="form-label">Or enter PDB ID</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="moleculePdbId" placeholder="e.g., 1CRN">
                        <button class="btn btn-outline-primary" type="button" id="fetchPdbBtn">Fetch</button>
                    </div>
                    <div class="form-text">Enter a valid PDB ID to fetch molecular data from the Protein Data Bank.</div>
                </div>
                
                <button type="button" class="btn btn-primary" id="loadCustomMoleculeBtn">
                    <i class="fas fa-atom me-1"></i> Load Molecule
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Modal -->
<div class="modal fade" id="fullscreenModal" tabindex="-1" aria-labelledby="fullscreenModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fullscreenModalLabel">Fullscreen Molecule Viewer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div id="fullscreen-molecule-viewer" style="height: 100%; width: 100%;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Global variables
    let viewer = null;
    let fullscreenViewer = null;
    let currentStyle = 'stick';
    let currentMolecule = null;
    let showLabels = true;
    
    // Molecule data
    const moleculeData = {
        psilocybin: {
            name: "Psilocybin",
            formula: "C₁₂H₁₇N₂O₄P",
            description: "Psilocybin is a naturally occurring psychedelic compound produced by more than 200 species of mushrooms, collectively known as psilocybin mushrooms. It has potential therapeutic applications in treating depression, anxiety, and addiction.",
            smiles: "CN(C)CCc1c[nH]c2cccc(OP(=O)(O)O)c12",
            mw: 284.27,
            pdb: `HETATM    1  P   UNL     1       1.035  -0.068   0.371  1.00  0.00           P  
HETATM    2  O1  UNL     1      -0.018   0.824  -0.168  1.00  0.00           O  
HETATM    3  O2  UNL     1       1.041  -1.474  -0.337  1.00  0.00           O  
HETATM    4  O3  UNL     1       2.436   0.634   0.246  1.00  0.00           O  
HETATM    5  O4  UNL     1       0.735  -0.169   1.928  1.00  0.00           O  
HETATM    6  C1  UNL     1       0.731  -0.322   3.291  1.00  0.00           C  
HETATM    7  C2  UNL     1      -0.492  -0.001   3.882  1.00  0.00           C  
HETATM    8  C3  UNL     1      -0.580  -0.099   5.267  1.00  0.00           C  
HETATM    9  C4  UNL     1       0.536  -0.517   6.014  1.00  0.00           C  
HETATM   10  C5  UNL     1       1.748  -0.835   5.392  1.00  0.00           C  
HETATM   11  C6  UNL     1       1.852  -0.741   4.009  1.00  0.00           C  
HETATM   12  C7  UNL     1       3.154  -1.036   3.326  1.00  0.00           C  
HETATM   13  C8  UNL     1       3.974  -1.962   4.230  1.00  0.00           C  
HETATM   14  N1  UNL     1       2.888  -1.594   1.984  1.00  0.00           N  
HETATM   15  C9  UNL     1       2.541  -3.033   1.984  1.00  0.00           C  
HETATM   16  C10 UNL     1       3.841  -0.968   0.991  1.00  0.00           C  
HETATM   17  N2  UNL     1       0.422  -0.603   7.390  1.00  0.00           N  
HETATM   18  C11 UNL     1      -0.840  -0.309   7.776  1.00  0.00           C  
HETATM   19  C12 UNL     1      -1.512   0.070   6.603  1.00  0.00           C  
HETATM   20  H1  UNL     1       1.856  -1.785  -0.233  1.00  0.00           H  
HETATM   21  H2  UNL     1      -1.348   0.323   3.302  1.00  0.00           H  
HETATM   22  H3  UNL     1       2.613  -1.159   5.971  1.00  0.00           H  
HETATM   23  H4  UNL     1       3.721  -0.097   3.257  1.00  0.00           H  
HETATM   24  H5  UNL     1       4.881  -2.263   3.691  1.00  0.00           H  
HETATM   25  H6  UNL     1       4.268  -1.437   5.147  1.00  0.00           H  
HETATM   26  H7  UNL     1       3.403  -2.864   4.489  1.00  0.00           H  
HETATM   27  H8  UNL     1       3.471  -3.576   1.756  1.00  0.00           H  
HETATM   28  H9  UNL     1       1.809  -3.223   1.188  1.00  0.00           H  
HETATM   29  H10 UNL     1       2.131  -3.341   2.954  1.00  0.00           H  
HETATM   30  H11 UNL     1       3.389  -1.047  -0.003  1.00  0.00           H  
HETATM   31  H12 UNL     1       4.753  -1.566   0.917  1.00  0.00           H  
HETATM   32  H13 UNL     1       4.072   0.075   1.241  1.00  0.00           H  
HETATM   33  H14 UNL     1       1.131  -0.896   8.056  1.00  0.00           H  
HETATM   34  H15 UNL     1      -1.237  -0.330   8.783  1.00  0.00           H  
HETATM   35  H16 UNL     1      -2.546   0.390   6.540  1.00  0.00           H  
END`
        },
        psilocin: {
            name: "Psilocin",
            formula: "C₁₂H₁₆N₂O",
            description: "Psilocin is the pharmacologically active agent in the body after psilocybin is ingested and metabolized by the liver. It acts on serotonin receptors in the brain.",
            smiles: "CN(C)CCc1c[nH]c2cccc(O)c12",
            mw: 204.27,
            pdb: `HETATM    1  O1  UNL     1       0.731  -0.169   1.928  1.00  0.00           O  
HETATM    2  C1  UNL     1       0.731  -0.322   3.291  1.00  0.00           C  
HETATM    3  C2  UNL     1      -0.492  -0.001   3.882  1.00  0.00           C  
HETATM    4  C3  UNL     1      -0.580  -0.099   5.267  1.00  0.00           C  
HETATM    5  C4  UNL     1       0.536  -0.517   6.014  1.00  0.00           C  
HETATM    6  C5  UNL     1       1.748  -0.835   5.392  1.00  0.00           C  
HETATM    7  C6  UNL     1       1.852  -0.741   4.009  1.00  0.00           C  
HETATM    8  C7  UNL     1       3.154  -1.036   3.326  1.00  0.00           C  
HETATM    9  C8  UNL     1       3.974  -1.962   4.230  1.00  0.00           C  
HETATM   10  N1  UNL     1       2.888  -1.594   1.984  1.00  0.00           N  
HETATM   11  C9  UNL     1       2.541  -3.033   1.984  1.00  0.00           C  
HETATM   12  C10 UNL     1       3.841  -0.968   0.991  1.00  0.00           C  
HETATM   13  N2  UNL     1       0.422  -0.603   7.390  1.00  0.00           N  
HETATM   14  C11 UNL     1      -0.840  -0.309   7.776  1.00  0.00           C  
HETATM   15  C12 UNL     1      -1.512   0.070   6.603  1.00  0.00           C  
HETATM   16  H1  UNL     1       1.553  -0.058   1.479  1.00  0.00           H  
HETATM   17  H2  UNL     1      -1.348   0.323   3.302  1.00  0.00           H  
HETATM   18  H3  UNL     1       2.613  -1.159   5.971  1.00  0.00           H  
HETATM   19  H4  UNL     1       3.721  -0.097   3.257  1.00  0.00           H  
HETATM   20  H5  UNL     1       4.881  -2.263   3.691  1.00  0.00           H  
HETATM   21  H6  UNL     1       4.268  -1.437   5.147  1.00  0.00           H  
HETATM   22  H7  UNL     1       3.403  -2.864   4.489  1.00  0.00           H  
HETATM   23  H8  UNL     1       3.471  -3.576   1.756  1.00  0.00           H  
HETATM   24  H9  UNL     1       1.809  -3.223   1.188  1.00  0.00           H  
HETATM   25  H10 UNL     1       2.131  -3.341   2.954  1.00  0.00           H  
HETATM   26  H11 UNL     1       3.389  -1.047  -0.003  1.00  0.00           H  
HETATM   27  H12 UNL     1       4.753  -1.566   0.917  1.00  0.00           H  
HETATM   28  H13 UNL     1       4.072   0.075   1.241  1.00  0.00           H  
HETATM   29  H14 UNL     1       1.131  -0.896   8.056  1.00  0.00           H  
HETATM   30  H15 UNL     1      -1.237  -0.330   8.783  1.00  0.00           H  
HETATM   31  H16 UNL     1      -2.546   0.390   6.540  1.00  0.00           H  
END`
        },
        ergotamine: {
            name: "Ergotamine",
            formula: "C₃₃H₃₅N₅O₅",
            description: "Ergotamine is an ergopeptide and part of the ergot family of alkaloids. It is found in ergot and is structurally and biochemically similar to LSD, with medicinal use in treating migraines.",
            mw: 581.66,
            smiles: "CC1(C)SC2C(NC(=O)Cc3ccccc3)C(=O)N2C1C(=O)N(C)CC1CN(C)C2CC3=CNC4=CC=CC(=C34)C2=C1",
            pdb: `HEADER    ERGOTAMINE
COMPND    Ergotamine
AUTHOR    GENERATED BY OPEN BABEL 2.3.0
HETATM    1  C   UNK     1      -3.984   1.217  -0.450  1.00  0.00           C  
HETATM    2  C   UNK     1      -5.252   0.408  -0.192  1.00  0.00           C  
HETATM    3  C   UNK     1      -5.170  -0.881   0.676  1.00  0.00           C  
HETATM    4  C   UNK     1      -4.096  -1.827   0.084  1.00  0.00           C  
HETATM    5  C   UNK     1      -2.747  -1.099   0.095  1.00  0.00           C  
HETATM    6  C   UNK     1      -2.771   0.278  -0.597  1.00  0.00           C  
HETATM    7  O   UNK     1      -5.983   0.089  -1.375  1.00  0.00           O  
HETATM    8  C   UNK     1      -6.121  -1.330  -1.474  1.00  0.00           C  
HETATM    9  C   UNK     1      -6.539  -1.563   0.962  1.00  0.00           C  
HETATM   10  N   UNK     1      -7.023  -1.695  -0.439  1.00  0.00           N  
HETATM   11  C   UNK     1      -4.037  -3.107   0.910  1.00  0.00           C  
HETATM   12  N   UNK     1      -1.617  -1.877   0.569  1.00  0.00           N  
HETATM   13  C   UNK     1      -0.354  -1.352   0.540  1.00  0.00           C  
HETATM   14  O   UNK     1      -0.112  -0.171   0.259  1.00  0.00           O  
HETATM   15  C   UNK     1       0.796  -2.317   0.892  1.00  0.00           C  
HETATM   16  C   UNK     1       0.560  -3.792   0.482  1.00  0.00           C  
HETATM   17  C   UNK     1       0.351  -3.910  -1.046  1.00  0.00           C  
HETATM   18  C   UNK     1       1.662  -3.577  -1.831  1.00  0.00           C  
HETATM   19  C   UNK     1       2.798  -4.596  -1.579  1.00  0.00           C  
HETATM   20  C   UNK     1       3.283  -4.520  -0.123  1.00  0.00           C  
HETATM   21  C   UNK     1       2.126  -4.759   0.880  1.00  0.00           C  
HETATM   22  C   UNK     1       1.952  -6.234   1.357  1.00  0.00           C  
HETATM   23  C   UNK     1       2.576  -4.037   2.182  1.00  0.00           C  
HETATM   24  C   UNK     1       3.933  -3.273   2.060  1.00  0.00           C  
HETATM   25  C   UNK     1       4.037  -2.518   0.713  1.00  0.00           C  
HETATM   26  C   UNK     1       4.152  -3.232  -0.446  1.00  0.00           C  
HETATM   27  N   UNK     1       4.308  -2.401  -1.503  1.00  0.00           N  
HETATM   28  C   UNK     1       4.283  -1.145  -1.013  1.00  0.00           C  
HETATM   29  C   UNK     1       4.117  -1.125   0.372  1.00  0.00           C  
HETATM   30  C   UNK     1       4.015   0.073   1.259  1.00  0.00           C  
HETATM   31  C   UNK     1       4.452   0.038  -1.807  1.00  0.00           C  
HETATM   32  C   UNK     1       4.588   1.165  -1.035  1.00  0.00           C  
HETATM   33  C   UNK     1       4.425   1.271   0.351  1.00  0.00           C  
HETATM   34  C   UNK     1       4.602   2.462   1.134  1.00  0.00           C  
HETATM   35  C   UNK     1       4.970   3.659   0.450  1.00  0.00           C  
HETATM   36  C   UNK     1       5.119   3.618  -0.902  1.00  0.00           C  
HETATM   37  C   UNK     1       4.923   2.407  -1.655  1.00  0.00           C  
HETATM   38  O   UNK     1      -8.129  -2.048  -0.780  1.00  0.00           O  
HETATM   39  C   UNK     1      -1.563   0.987  -0.071  1.00  0.00           C  
HETATM   40  O   UNK     1      -0.537   1.224  -0.709  1.00  0.00           O  
HETATM   41  N   UNK     1      -1.680   1.361   1.207  1.00  0.00           N  
HETATM   42  C   UNK     1      -2.883   1.090   1.996  1.00  0.00           C  
HETATM   43  C   UNK     1      -0.598   2.037   1.918  1.00  0.00           C  
HETATM   44  C   UNK     1       0.587   2.477   1.012  1.00  0.00           C  
HETATM   45  C   UNK     1       1.749   3.076   1.821  1.00  0.00           C  
HETATM   46  C   UNK     1       2.247   2.156   2.952  1.00  0.00           C  
HETATM   47  C   UNK     1       1.130   1.759   3.933  1.00  0.00           C  
HETATM   48  C   UNK     1      -0.077   1.150   3.198  1.00  0.00           C  
HETATM   49  O   UNK     1       1.637   0.787   4.841  1.00  0.00           O  
HETATM   50  C   UNK     1       0.691   0.428   5.855  1.00  0.00           C  
HETATM   51  C   UNK     1      -0.480  -0.315   5.235  1.00  0.00           C  
HETATM   52  C   UNK     1      -0.878   0.077   3.825  1.00  0.00           C  
HETATM   53  O   UNK     1      -1.958  -0.354   3.425  1.00  0.00           O  
HETATM   54  C   UNK     1       0.275  -0.455   7.086  1.00  0.00           C  
HETATM   55  C   UNK     1      -0.768  -1.375   6.952  1.00  0.00           C  
HETATM   56  N   UNK     1      -1.173  -1.398   5.658  1.00  0.00           N  
HETATM   57  H   UNK     1      -4.012   1.580  -1.486  1.00  0.00           H  
HETATM   58  H   UNK     1      -3.991   2.108   0.180  1.00  0.00           H  
HETATM   59  H   UNK     1      -5.900   1.071   0.309  1.00  0.00           H  
HETATM   60  H   UNK     1      -4.831  -0.633   1.690  1.00  0.00           H  
HETATM   61  H   UNK     1      -4.360  -2.080  -0.948  1.00  0.00           H  
HETATM   62  H   UNK     1      -2.778   0.127  -1.677  1.00  0.00           H  
HETATM   63  H   UNK     1      -6.547  -1.578  -2.445  1.00  0.00           H  
HETATM   64  H   UNK     1      -7.271  -0.930   1.526  1.00  0.00           H  
HETATM   65  H   UNK     1      -6.461  -2.541   1.432  1.00  0.00           H  
HETATM   66  H   UNK     1      -3.341  -3.829   0.472  1.00  0.00           H  
HETATM   67  H   UNK     1      -3.714  -2.921   1.939  1.00  0.00           H  
HETATM   68  H   UNK     1      -5.018  -3.584   0.932  1.00  0.00           H  
HETATM   69  H   UNK     1      -1.723  -2.856   0.819  1.00  0.00           H  
HETATM   70  H   UNK     1       0.895  -2.251   1.980  1.00  0.00           H  
HETATM   71  H   UNK     1       1.724  -1.978   0.419  1.00  0.00           H  
HETATM   72  H   UNK     1      -0.253  -4.210   1.069  1.00  0.00           H  
HETATM   73  H   UNK     1      -0.431  -3.260  -1.356  1.00  0.00           H  
HETATM   74  H   UNK     1       0.044  -4.935  -1.266  1.00  0.00           H  
HETATM   75  H   UNK     1       1.433  -3.542  -2.903  1.00  0.00           H  
HETATM   76  H   UNK     1       2.007  -2.580  -1.540  1.00  0.00           H  
HETATM   77  H   UNK     1       2.438  -5.607  -1.792  1.00  0.00           H  
HETATM   78  H   UNK     1       3.621  -4.404  -2.275  1.00  0.00           H  
HETATM   79  H   UNK     1       3.905  -5.402   0.074  1.00  0.00           H  
HETATM   80  H   UNK     1       1.566  -6.825   0.518  1.00  0.00           H  
HETATM   81  H   UNK     1       2.935  -6.669   1.576  1.00  0.00           H  
HETATM   82  H   UNK     1       1.314  -6.342   2.242  1.00  0.00           H  
HETATM   83  H   UNK     1       2.614  -4.741   3.018  1.00  0.00           H  
HETATM   84  H   UNK     1       1.817  -3.303   2.424  1.00  0.00           H  
HETATM   85  H   UNK     1       4.052  -2.598   2.914  1.00  0.00           H  
HETATM   86  H   UNK     1       4.749  -3.989   2.166  1.00  0.00           H  
HETATM   87  H   UNK     1       4.465  -2.687  -2.480  1.00  0.00           H  
HETATM   88  H   UNK     1       3.642   0.007   2.287  1.00  0.00           H  
HETATM   89  H   UNK     1       4.447  -0.026  -2.887  1.00  0.00           H  
HETATM   90  H   UNK     1       4.489   2.439   2.216  1.00  0.00           H  
HETATM   91  H   UNK     1       5.108   4.602   0.979  1.00  0.00           H  
HETATM   92  H   UNK     1       5.404   4.523  -1.431  1.00  0.00           H  
HETATM   93  H   UNK     1       5.033   2.408  -2.735  1.00  0.00           H  
HETATM   94  H   UNK     1      -2.649   1.169   3.051  1.00  0.00           H  
HETATM   95  H   UNK     1      -3.305   0.091   1.850  1.00  0.00           H  
HETATM   96  H   UNK     1      -3.616   1.831   1.718  1.00  0.00           H  
HETATM   97  H   UNK     1      -1.039   2.930   2.376  1.00  0.00           H  
HETATM   98  H   UNK     1       0.946   1.632   0.415  1.00  0.00           H  
HETATM   99  H   UNK     1       0.219   3.202   0.284  1.00  0.00           H  
HETATM  100  H   UNK     1       2.571   3.343   1.160  1.00  0.00           H  
HETATM  101  H   UNK     1       1.401   3.983   2.321  1.00  0.00           H  
HETATM  102  H   UNK     1       2.728   1.272   2.536  1.00  0.00           H  
HETATM  103  H   UNK     1       3.005   2.649   3.569  1.00  0.00           H  
HETATM  104  H   UNK     1       1.475   2.594   4.551  1.00  0.00           H  
HETATM  105  H   UNK     1       0.220   0.599   2.438  1.00  0.00           H  
HETATM  106  H   UNK     1       1.177   1.249   6.385  1.00  0.00           H  
HETATM  107  H   UNK     1       0.732  -0.218   8.053  1.00  0.00           H  
HETATM  108  H   UNK     1      -1.297  -2.041   7.621  1.00  0.00           H  
HETATM  109  H   UNK     1      -1.924  -2.017   5.342  1.00  0.00           H  
CONECT    1    2    6   57   58                                       
CONECT    2    1    3    7   59                                       
CONECT    3    2    4    9   60                                       
CONECT    4    3    5   11   61                                       
CONECT    5    4    6   12                                            
CONECT    6    1    5   39   62                                       
CONECT    7    2    8                                                 
CONECT    8    7   10   63                                            
CONECT    9    3   10   64   65                                       
CONECT   10    8    9   38                                            
CONECT   11    4   66   67   68                                       
CONECT   12    5   13   69                                            
CONECT   13   12   14   15                                            
CONECT   14   13                                                      
CONECT   15   13   16   70   71                                       
CONECT   16   15   17   21   72                                       
CONECT   17   16   18   73   74                                       
CONECT   18   17   19   75   76                                       
CONECT   19   18   20   77   78                                       
CONECT   20   19   21   26   79                                       
CONECT   21   16   20   22   23                                       
CONECT   22   21   80   81   82                                       
CONECT   23   21   24   83   84                                       
CONECT   24   23   25   85   86                                       
CONECT   25   24   26   29                                            
CONECT   26   20   25   27                                            
CONECT   27   26   28   87                                            
CONECT   28   27   29   31                                            
CONECT   29   25   28   30                                            
CONECT   30   29   33   88                                            
CONECT   31   28   32   89                                            
CONECT   32   31   33   37                                            
CONECT   33   30   32   34                                            
CONECT   34   33   35   90                                            
CONECT   35   34   36   91                                            
CONECT   36   35   37   92                                            
CONECT   37   32   36   93                                            
CONECT   38   10                                                      
CONECT   39    6   40   41                                            
CONECT   40   39                                                      
CONECT   41   39   42   43                                            
CONECT   42   41   94   95   96                                       
CONECT   43   41   44   48   97                                       
CONECT   44   43   45   98   99                                       
CONECT   45   44   46  100  101                                       
CONECT   46   45   47  102  103                                       
CONECT   47   46   48   49  104                                       
CONECT   48   43   47   52  105                                       
CONECT   49   47   50                                                 
CONECT   50   49   51   54  106                                       
CONECT   51   50   52   56                                            
CONECT   52   48   51   53                                            
CONECT   53   52                                                      
CONECT   54   50   55  107                                            
CONECT   55   54   56  108                                            
CONECT   56   51   55  109                                            
CONECT   57    1                                                      
CONECT   58    1                                                      
CONECT   59    2                                                      
CONECT   60    3                                                      
CONECT   61    4                                                      
CONECT   62    6                                                      
CONECT   63    8                                                      
CONECT   64    9                                                      
CONECT   65    9                                                      
CONECT   66   11                                                      
CONECT   67   11                                                      
CONECT   68   11                                                      
CONECT   69   12                                                      
CONECT   70   15                                                      
CONECT   71   15                                                      
CONECT   72   16                                                      
CONECT   73   17                                                      
CONECT   74   17                                                      
CONECT   75   18                                                      
CONECT   76   18                                                      
CONECT   77   19                                                      
CONECT   78   19                                                      
CONECT   79   20                                                      
CONECT   80   22                                                      
CONECT   81   22                                                      
CONECT   82   22                                                      
CONECT   83   23                                                      
CONECT   84   23                                                      
CONECT   85   24                                                      
CONECT   86   24                                                      
CONECT   87   27                                                      
CONECT   88   30                                                      
CONECT   89   31                                                      
CONECT   90   34                                                      
CONECT   91   35                                                      
CONECT   92   36                                                      
CONECT   93   37                                                      
CONECT   94   42                                                      
CONECT   95   42                                                      
CONECT   96   42                                                      
CONECT   97   43                                                      
CONECT   98   44                                                      
CONECT   99   44                                                      
CONECT  100   45                                                      
CONECT  101   45                                                      
CONECT  102   46                                                      
CONECT  103   46                                                      
CONECT  104   47                                                      
CONECT  105   48                                                      
CONECT  106   50                                                      
CONECT  107   54                                                      
CONECT  108   55                                                      
CONECT  109   56                                                      
MASTER        0    0    0    0    0    0    0    0  109    0  109    0
END`
        },
        betulinic_acid: {
            name: "Betulinic Acid",
            formula: "C₃₀H₄₈O₃",
            description: "Betulinic acid is a pentacyclic triterpenoid with anti-inflammatory, antimalarial, and anticancer properties. It is found in various plant species, particularly in the bark of birch trees.",
            mw: 456.7,
            smiles: "CC(C)C1CCC2(C)CCC3(C)C(CCC4(C)C3CCC4(C)C(=O)O)C12",
            pdb: `COMPND    BETULINIC ACID
AUTHOR    GENERATED BY OPEN BABEL 3.1.0
HETATM    1  C   UNL     1      -0.009   1.532   0.077  1.00  0.00           C  
HETATM    2  C   UNL     1       0.068   0.010   0.042  1.00  0.00           C  
HETATM    3  C   UNL     1       1.487  -0.534   0.218  1.00  0.00           C  
HETATM    4  C   UNL     1       2.505   0.221   1.083  1.00  0.00           C  
HETATM    5  C   UNL     1       2.442   1.754   0.861  1.00  0.00           C  
HETATM    6  C   UNL     1       1.001   2.261   0.985  1.00  0.00           C  
HETATM    7  C   UNL     1       0.842   3.787   0.840  1.00  0.00           C  
HETATM    8  C   UNL     1       1.827   4.485   1.798  1.00  0.00           C  
HETATM    9  C   UNL     1       3.270   4.002   1.557  1.00  0.00           C  
HETATM   10  C   UNL     1       3.333   2.474   1.743  1.00  0.00           C  
HETATM   11  C   UNL     1       3.123   2.124   3.236  1.00  0.00           C  
HETATM   12  C   UNL     1       4.767   2.051   1.339  1.00  0.00           C  
HETATM   13  C   UNL     1       5.746   2.805   2.248  1.00  0.00           C  
HETATM   14  C   UNL     1       7.176   2.410   1.870  1.00  0.00           C  
HETATM   15  C   UNL     1       7.422   0.917   2.039  1.00  0.00           C  
HETATM   16  C   UNL     1       7.544   0.575   3.527  1.00  0.00           C  
HETATM   17  C   UNL     1       8.659   0.548   1.267  1.00  0.00           C  
HETATM   18  C   UNL     1       8.531   0.852  -0.225  1.00  0.00           C  
HETATM   19  C   UNL     1       9.797   0.492  -0.991  1.00  0.00           C  
HETATM   20  C   UNL     1       9.682   0.812  -2.456  1.00  0.00           C  
HETATM   21  C   UNL     1      10.903   0.415  -3.224  1.00  0.00           C  
HETATM   22  C   UNL     1      10.744   0.712  -4.670  1.00  0.00           C  
HETATM   23  C   UNL     1      11.939   0.306  -5.444  1.00  0.00           C  
HETATM   24  C   UNL     1      11.802   0.605  -6.857  1.00  0.00           C  
HETATM   25  C   UNL     1      12.983   0.242  -7.568  1.00  0.00           C  
HETATM   26  C   UNL     1      14.169  -0.393  -6.895  1.00  0.00           C  
HETATM   27  C   UNL     1      14.294  -0.680  -5.483  1.00  0.00           C  
HETATM   28  C   UNL     1      13.148  -0.324  -4.766  1.00  0.00           C  
HETATM   29  C   UNL     1       1.908  -0.590  -1.260  1.00  0.00           C  
HETATM   30  C   UNL     1       2.071  -2.055  -1.695  1.00  0.00           C  
HETATM   31  C   UNL     1       1.478  -1.965   0.783  1.00  0.00           C  
HETATM   32  C   UNL     1       2.878  -2.557   0.954  1.00  0.00           C  
HETATM   33  C   UNL     1       3.884  -1.897   1.911  1.00  0.00           C  
HETATM   34  C   UNL     1       4.006  -0.383   1.756  1.00  0.00           C  
HETATM   35  O   UNL     1       4.522  -2.544   2.954  1.00  0.00           O  
HETATM   36  C   UNL     1       4.603   0.062   0.411  1.00  0.00           C  
HETATM   37  C   UNL     1       5.022   0.552   2.814  1.00  0.00           C  
HETATM   38  C   UNL     1      13.001  -0.640  -3.308  1.00  0.00           C  
HETATM   39  C   UNL     1      13.043   0.544  -8.987  1.00  0.00           C  
HETATM   40  O   UNL     1      14.054   0.235  -9.603  1.00  0.00           O  
HETATM   41  O   UNL     1      12.025   1.114  -9.614  1.00  0.00           O  
HETATM   42  C   UNL     1       2.181  -0.165  -4.195  1.00  0.00           C  
HETATM   43  H   UNL     1      -1.016   1.849  -0.218  1.00  0.00           H  
HETATM   44  H   UNL     1      -0.386  -0.384  -0.869  1.00  0.00           H  
HETATM   45  H   UNL     1      -0.526  -0.382   0.872  1.00  0.00           H  
HETATM   46  H   UNL     1       2.268  -0.093   2.121  1.00  0.00           H  
HETATM   47  H   UNL     1       2.817   1.939  -0.149  1.00  0.00           H  
HETATM   48  H   UNL     1       0.678   2.010   1.999  1.00  0.00           H  
HETATM   49  H   UNL     1      -0.198   4.094   1.041  1.00  0.00           H  
HETATM   50  H   UNL     1       1.058   4.088  -0.193  1.00  0.00           H  
HETATM   51  H   UNL     1       1.518   4.271   2.832  1.00  0.00           H  
HETATM   52  H   UNL     1       1.771   5.574   1.682  1.00  0.00           H  
HETATM   53  H   UNL     1       3.949   4.489   2.267  1.00  0.00           H  
HETATM   54  H   UNL     1       3.593   4.288   0.546  1.00  0.00           H  
HETATM   55  H   UNL     1       2.077   2.309   3.519  1.00  0.00           H  
HETATM   56  H   UNL     1       3.759   2.729   3.889  1.00  0.00           H  
HETATM   57  H   UNL     1       3.365   1.068   3.418  1.00  0.00           H  
HETATM   58  H   UNL     1       5.031   2.267   0.298  1.00  0.00           H  
HETATM   59  H   UNL     1       5.491   2.610   3.299  1.00  0.00           H  
HETATM   60  H   UNL     1       5.648   3.891   2.125  1.00  0.00           H  
HETATM   61  H   UNL     1       7.898   2.983   2.468  1.00  0.00           H  
HETATM   62  H   UNL     1       7.416   2.701   0.840  1.00  0.00           H  
HETATM   63  H   UNL     1       6.582   0.377   1.611  1.00  0.00           H  
HETATM   64  H   UNL     1       8.383   1.106   3.974  1.00  0.00           H  
HETATM   65  H   UNL     1       7.735  -0.491   3.667  1.00  0.00           H  
HETATM   66  H   UNL     1       6.648   0.857   4.090  1.00  0.00           H  
HETATM   67  H   UNL     1       8.845  -0.525   1.389  1.00  0.00           H  
HETATM   68  H   UNL     1       9.541   1.033   1.704  1.00  0.00           H  
HETATM   69  H   UNL     1       7.669   0.346  -0.679  1.00  0.00           H  
HETATM   70  H   UNL     1       8.331   1.922  -0.357  1.00  0.00           H  
HETATM   71  H   UNL     1      10.659   0.997  -0.537  1.00  0.00           H  
HETATM   72  H   UNL     1       9.997  -0.577  -0.860  1.00  0.00           H  
HETATM   73  H   UNL     1       8.821   0.306  -2.910  1.00  0.00           H  
HETATM   74  H   UNL     1       9.481   1.881  -2.587  1.00  0.00           H  
HETATM   75  H   UNL     1      11.763   0.922  -2.770  1.00  0.00           H  
HETATM   76  H   UNL     1      11.104  -0.654  -3.093  1.00  0.00           H  
HETATM   77  H   UNL     1       9.884   0.205  -5.124  1.00  0.00           H  
HETATM   78  H   UNL     1      10.543   1.781  -4.801  1.00  0.00           H  
HETATM   79  H   UNL     1      10.882   1.080  -7.254  1.00  0.00           H  
HETATM   80  H   UNL     1      15.017  -0.659  -7.520  1.00  0.00           H  
HETATM   81  H   UNL     1      15.214  -1.162  -5.112  1.00  0.00           H  
HETATM   82  H   UNL     1       1.180   0.000  -1.857  1.00  0.00           H  
HETATM   83  H   UNL     1       2.874  -0.079  -1.363  1.00  0.00           H  
HETATM   84  H   UNL     1       2.967  -2.541  -1.283  1.00  0.00           H  
HETATM   85  H   UNL     1       1.223  -2.654  -1.338  1.00  0.00           H  
HETATM   86  H   UNL     1       2.168  -2.136  -2.779  1.00  0.00           H  
HETATM   87  H   UNL     1       0.837  -2.594   0.163  1.00  0.00           H  
HETATM   88  H   UNL     1       1.032  -1.975   1.782  1.00  0.00           H  
HETATM   89  H   UNL     1       2.774  -3.605   1.275  1.00  0.00           H  
HETATM   90  H   UNL     1       3.312  -2.579  -0.050  1.00  0.00           H  
HETATM   91  H   UNL     1       3.460  -2.044   2.903  1.00  0.00           H  
HETATM   92  H   UNL     1       4.214  -2.173   3.820  1.00  0.00           H  
HETATM   93  H   UNL     1       5.596  -0.370   0.269  1.00  0.00           H  
HETATM   94  H   UNL     1       4.727  -0.705  -0.343  1.00  0.00           H  
HETATM   95  H   UNL     1       4.671   0.077   2.445  1.00  0.00           H  
HETATM   96  H   UNL     1       6.009   0.082   2.748  1.00  0.00           H  
HETATM   97  H   UNL     1       4.955   0.330   3.883  1.00  0.00           H  
HETATM   98  H   UNL     1      13.873  -0.311  -2.716  1.00  0.00           H  
HETATM   99  H   UNL     1      12.867  -1.717  -3.114  1.00  0.00           H  
HETATM  100  H   UNL     1      11.234   1.367  -9.112  1.00  0.00           H  
HETATM  101  H   UNL     1       2.241  -0.324  -3.116  1.00  0.00           H  
HETATM  102  H   UNL     1       1.119  -0.219  -4.456  1.00  0.00           H  
HETATM  103  H   UNL     1       2.743   0.747  -4.424  1.00  0.00           H  
HETATM  104  H   UNL     1       2.659  -0.995  -4.714  1.00  0.00           H  
CONECT    1    2    6   43                                            
CONECT    2    1    3   44   45                                       
CONECT    3    2    4   29   31                                       
CONECT    4    3    5   34   46                                       
CONECT    5    4    6   10   47                                       
CONECT    6    1    5    7   48                                       
CONECT    7    6    8   49   50                                       
CONECT    8    7    9   51   52                                       
CONECT    9    8   10   53   54                                       
CONECT   10    5    9   11   12                                       
CONECT   11   10   55   56   57                                       
CONECT   12   10   13   36   58                                       
CONECT   13   12   14   59   60                                       
CONECT   14   13   15   61   62                                       
CONECT   15   14   16   17   63                                       
CONECT   16   15   64   65   66                                       
CONECT   17   15   18   67   68                                       
CONECT   18   17   19   69   70                                       
CONECT   19   18   20   71   72                                       
CONECT   20   19   21   73   74                                       
CONECT   21   20   22   75   76                                       
CONECT   22   21   23   77   78                                       
CONECT   23   22   24   28                                            
CONECT   24   23   25   79                                            
CONECT   25   24   26   39                                            
CONECT   26   25   27   80                                            
CONECT   27   26   28   81                                            
CONECT   28   23   27   38                                            
CONECT   29    3   30   82   83                                       
CONECT   30   29   84   85   86                                       
CONECT   31    3   32   87   88                                       
CONECT   32   31   33   89   90                                       
CONECT   33   32   34   35   91                                       
CONECT   34    4   33   36   37                                       
CONECT   35   33   92                                                 
CONECT   36   12   34   93   94                                       
CONECT   37   34   95   96   97                                       
CONECT   38   28   98   99   42                                       
CONECT   39   25   40   41                                            
CONECT   40   39                                                      
CONECT   41   39  100                                                 
CONECT   42   38  101  102  103                                       
CONECT   42  104                                                      
CONECT   43    1                                                      
CONECT   44    2                                                      
CONECT   45    2                                                      
CONECT   46    4                                                      
CONECT   47    5                                                      
CONECT   48    6                                                      
CONECT   49    7                                                      
CONECT   50    7                                                      
CONECT   51    8                                                      
CONECT   52    8                                                      
CONECT   53    9                                                      
CONECT   54    9                                                      
CONECT   55   11                                                      
CONECT   56   11                                                      
CONECT   57   11                                                      
CONECT   58   12                                                      
CONECT   59   13                                                      
CONECT   60   13                                                      
CONECT   61   14                                                      
CONECT   62   14                                                      
CONECT   63   15                                                      
CONECT   64   16                                                      
CONECT   65   16                                                      
CONECT   66   16                                                      
CONECT   67   17                                                      
CONECT   68   17                                                      
CONECT   69   18                                                      
CONECT   70   18                                                      
CONECT   71   19                                                      
CONECT   72   19                                                      
CONECT   73   20                                                      
CONECT   74   20                                                      
CONECT   75   21                                                      
CONECT   76   21                                                      
CONECT   77   22                                                      
CONECT   78   22                                                      
CONECT   79   24                                                      
CONECT   80   26                                                      
CONECT   81   27                                                      
CONECT   82   29                                                      
CONECT   83   29                                                      
CONECT   84   30                                                      
CONECT   85   30                                                      
CONECT   86   30                                                      
CONECT   87   31                                                      
CONECT   88   31                                                      
CONECT   89   32                                                      
CONECT   90   32                                                      
CONECT   91   33                                                      
CONECT   92   35                                                      
CONECT   93   36                                                      
CONECT   94   36                                                      
CONECT   95   37                                                      
CONECT   96   37                                                      
CONECT   97   37                                                      
CONECT   98   38                                                      
CONECT   99   38                                                      
CONECT  100   41                                                      
CONECT  101   42                                                      
CONECT  102   42                                                      
CONECT  103   42                                                      
CONECT  104   42                                                      
MASTER        0    0    0    0    0    0    0    0  104    0  104    0
END`
        },
        ganoderic_acid: {
            name: "Ganoderic Acid",
            formula: "C₃₀H₄₄O₈",
            description: "Ganoderic acid is a type of triterpene found in Ganoderma lucidum (Reishi mushroom). It has demonstrated hepatoprotective, antitumor and anti-inflammatory effects in various studies.",
            mw: 532.67,
            smiles: "CC(=O)OC(C)(C)C1CCC2(C)C3=CC(=O)C4C(C)(C(O)C(O)C(C)C45CCC4(C)C(C(=O)O)CCC34C)C12",
            pdb: `HETATM    1  C   UNK     1      -1.953   0.344   0.126  1.00  0.00           C  
HETATM    2  C   UNK     1      -1.359  -0.906   0.823  1.00  0.00           C  
HETATM    3  C   UNK     1       0.127  -1.077   0.468  1.00  0.00           C  
HETATM    4  C   UNK     1       0.359  -0.874  -1.042  1.00  0.00           C  
HETATM    5  C   UNK     1      -0.340   0.360  -1.601  1.00  0.00           C  
HETATM    6  C   UNK     1      -1.830   0.446  -1.386  1.00  0.00           C  
HETATM    7  C   UNK     1       0.996  -0.132   1.304  1.00  0.00           C  
HETATM    8  C   UNK     1       2.486  -0.352   0.928  1.00  0.00           C  
HETATM    9  C   UNK     1       2.727  -0.140  -0.581  1.00  0.00           C  
HETATM   10  C   UNK     1       1.871  -1.057  -1.414  1.00  0.00           C  
HETATM   11  C   UNK     1       4.216  -0.326  -0.918  1.00  0.00           C  
HETATM   12  C   UNK     1       5.131   0.652  -0.180  1.00  0.00           C  
HETATM   13  C   UNK     1       6.620   0.481  -0.513  1.00  0.00           C  
HETATM   14  C   UNK     1       6.823  -0.935  -1.083  1.00  0.00           C  
HETATM   15  C   UNK     1       5.897  -1.927  -0.367  1.00  0.00           C  
HETATM   16  C   UNK     1       4.442  -1.806  -0.624  1.00  0.00           C  
HETATM   17  C   UNK     1       2.416   1.291  -0.987  1.00  0.00           C  
HETATM   18  C   UNK     1       2.593   2.317   0.107  1.00  0.00           C  
HETATM   19  C   UNK     1       1.932   2.007   1.463  1.00  0.00           C  
HETATM   20  C   UNK     1       0.803   1.320   0.965  1.00  0.00           C  
HETATM   21  C   UNK     1      -0.522   1.561   1.394  1.00  0.00           C  
HETATM   22  C   UNK     1      -1.288   1.628   0.080  1.00  0.00           C  
HETATM   23  C   UNK     1       0.615  -2.469   0.832  1.00  0.00           C  
HETATM   24  C   UNK     1      -3.435   0.313   0.574  1.00  0.00           C  
HETATM   25  C   UNK     1      -4.285  -0.664  -0.275  1.00  0.00           C  
HETATM   26  C   UNK     1      -3.571   0.063   2.064  1.00  0.00           C  
HETATM   27  C   UNK     1      -4.096   1.654   0.354  1.00  0.00           C  
HETATM   28  C   UNK     1      -4.045   1.867  -1.107  1.00  0.00           C  
HETATM   29  O   UNK     1      -5.090   2.195  -1.661  1.00  0.00           O  
HETATM   30  O   UNK     1      -2.856   1.668  -1.757  1.00  0.00           O  
HETATM   31  C   UNK     1       0.877  -0.277   2.811  1.00  0.00           C  
HETATM   32  C   UNK     1       3.349  -1.359   1.625  1.00  0.00           C  
HETATM   33  O   UNK     1       3.606  -2.357  -0.009  1.00  0.00           O  
HETATM   34  O   UNK     1      -0.963   2.690   2.141  1.00  0.00           O  
HETATM   35  C   UNK     1      -1.986   2.853   0.094  1.00  0.00           C  
HETATM   36  O   UNK     1      -1.058   3.452   0.968  1.00  0.00           O  
HETATM   37  O   UNK     1       4.290  -0.167  -2.310  1.00  0.00           O  
HETATM   38  C   UNK     1       4.766  -1.240  -3.117  1.00  0.00           C  
HETATM   39  O   UNK     1       4.870  -1.033  -4.322  1.00  0.00           O  
HETATM   40  C   UNK     1       5.041  -2.612  -2.528  1.00  0.00           C  
HETATM   41  O   UNK     1       6.171  -3.001  -1.175  1.00  0.00           O  
HETATM   42  C   UNK     1       8.292  -1.324  -1.003  1.00  0.00           C  
HETATM   43  C   UNK     1       6.514  -1.041  -2.597  1.00  0.00           C  
HETATM   44  O   UNK     1       6.655   0.281  -3.113  1.00  0.00           O  
HETATM   45  O   UNK     1       7.416   1.309   0.263  1.00  0.00           O  
HETATM   46  C   UNK     1       8.780   1.502  -0.093  1.00  0.00           C  
HETATM   47  O   UNK     1       9.302   2.568   0.160  1.00  0.00           O  
HETATM   48  C   UNK     1       9.481   0.370  -0.743  1.00  0.00           C  
HETATM   49  H   UNK     1      -1.467  -0.831   1.908  1.00  0.00           H  
HETATM   50  H   UNK     1      -1.880  -1.807   0.484  1.00  0.00           H  
HETATM   51  H   UNK     1      -0.031  -1.714  -1.624  1.00  0.00           H  
HETATM   52  H   UNK     1       0.084   1.252  -1.147  1.00  0.00           H  
HETATM   53  H   UNK     1      -0.124   0.361  -2.667  1.00  0.00           H  
HETATM   54  H   UNK     1      -2.160  -0.380  -1.998  1.00  0.00           H  
HETATM   55  H   UNK     1       2.049  -0.968  -2.476  1.00  0.00           H  
HETATM   56  H   UNK     1       2.175  -2.085  -1.198  1.00  0.00           H  
HETATM   57  H   UNK     1       4.891   0.450   0.873  1.00  0.00           H  
HETATM   58  H   UNK     1       4.939   1.686  -0.475  1.00  0.00           H  
HETATM   59  H   UNK     1       6.929   0.548   0.539  1.00  0.00           H  
HETATM   60  H   UNK     1       6.508  -0.891  -0.029  1.00  0.00           H  
HETATM   61  H   UNK     1       6.209  -1.895   0.683  1.00  0.00           H  
HETATM   62  H   UNK     1       3.976  -2.397   0.170  1.00  0.00           H  
HETATM   63  H   UNK     1       1.380   1.342  -1.338  1.00  0.00           H  
HETATM   64  H   UNK     1       3.050   1.522  -1.852  1.00  0.00           H  
HETATM   65  H   UNK     1       3.665   2.532   0.175  1.00  0.00           H  
HETATM   66  H   UNK     1       2.192   3.278  -0.227  1.00  0.00           H  
HETATM   67  H   UNK     1       2.605   1.430   2.102  1.00  0.00           H  
HETATM   68  H   UNK     1       1.696   2.923   2.003  1.00  0.00           H  
HETATM   69  H   UNK     1      -0.401   1.597  -0.778  1.00  0.00           H  
HETATM   70  H   UNK     1       0.491  -2.661   1.902  1.00  0.00           H  
HETATM   71  H   UNK     1       0.023  -3.174   0.253  1.00  0.00           H  
HETATM   72  H   UNK     1       1.662  -2.648   0.587  1.00  0.00           H  
HETATM   73  H   UNK     1      -4.237  -0.434  -1.346  1.00  0.00           H  
HETATM   74  H   UNK     1      -5.323  -0.632   0.053  1.00  0.00           H  
HETATM   75  H   UNK     1      -3.946  -1.695  -0.191  1.00  0.00           H  
HETATM   76  H   UNK     1      -3.026  -0.853   2.269  1.00  0.00           H  
HETATM   77  H   UNK     1      -4.615  -0.010   2.367  1.00  0.00           H  
HETATM   78  H   UNK     1      -3.163   0.872   2.675  1.00  0.00           H  
HETATM   79  H   UNK     1      -3.630   2.473   0.905  1.00  0.00           H  
HETATM   80  H   UNK     1      -5.127   1.621   0.713  1.00  0.00           H  
HETATM   81  H   UNK     1       0.280   0.536   3.231  1.00  0.00           H  
HETATM   82  H   UNK     1       0.413  -1.204   3.152  1.00  0.00           H  
HETATM   83  H   UNK     1       1.871  -0.252   3.271  1.00  0.00           H  
HETATM   84  H   UNK     1       2.883  -2.344   1.600  1.00  0.00           H  
HETATM   85  H   UNK     1       3.461  -1.063   2.673  1.00  0.00           H  
HETATM   86  H   UNK     1       4.345  -1.438   1.185  1.00  0.00           H  
HETATM   87  H   UNK     1      -1.980   3.456  -0.827  1.00  0.00           H  
HETATM   88  H   UNK     1      -3.003   2.787   0.494  1.00  0.00           H  
HETATM   89  H   UNK     1       4.882  -3.392  -3.279  1.00  0.00           H  
HETATM   90  H   UNK     1       4.322  -2.954  -1.780  1.00  0.00           H  
HETATM   91  H   UNK     1       8.879  -0.651  -0.369  1.00  0.00           H  
HETATM   92  H   UNK     1       8.389  -2.316  -0.566  1.00  0.00           H  
HETATM   93  H   UNK     1       8.735  -1.387  -1.998  1.00  0.00           H  
HETATM   94  H   UNK     1       7.242  -1.638  -3.153  1.00  0.00           H  
HETATM   95  H   UNK     1       5.933   0.805  -2.709  1.00  0.00           H  
HETATM   96  H   UNK     1      10.468   0.264  -0.284  1.00  0.00           H  
HETATM   97  H   UNK     1       9.612   0.560  -1.811  1.00  0.00           H  
HETATM   98  H   UNK     1       8.889  -0.541  -0.612  1.00  0.00           H  
CONECT    1    2    6   22   24
CONECT    2    1    3   49   50
CONECT    3    2    4    7   23
CONECT    4    3    5   10   51
CONECT    5    4    6   52   53
CONECT    6    1    5   30   54
CONECT    7    3    8   20   31
CONECT    8    7    9   32
CONECT    9    8   10   11   17
CONECT   10    4    9   55   56
CONECT   11    9   12   16   37
CONECT   12   11   13   57   58
CONECT   13   12   14   45   59
CONECT   14   13   15   42   60
CONECT   15   14   16   41   61
CONECT   16   11   15   33   62
CONECT   17    9   18   63   64
CONECT   18   17   19   65   66
CONECT   19   18   20   67   68
CONECT   20    7   19   21
CONECT   21   20   22   34
CONECT   22    1   21   35   69
CONECT   23    3   70   71   72
CONECT   24    1   25   26   27
CONECT   25   24   73   74   75
CONECT   26   24   76   77   78
CONECT   27   24   28   79   80
CONECT   28   27   29   30
CONECT   29   28
CONECT   30    6   28
CONECT   31    7   81   82   83
CONECT   32    8   33   84   85
CONECT   32   86
CONECT   33   16   32
CONECT   34   21   36
CONECT   35   22   36   87   88
CONECT   36   34   35
CONECT   37   11   38
CONECT   38   37   39   40
CONECT   39   38
CONECT   40   38   41   43   89
CONECT   40   90
CONECT   41   15   40
CONECT   42   14   91   92   93
CONECT   43   40   44   94
CONECT   44   43   95
CONECT   45   13   46
CONECT   46   45   47   48
CONECT   47   46
CONECT   48   46   96   97   98
CONECT   49    2
CONECT   50    2
CONECT   51    4
CONECT   52    5
CONECT   53    5
CONECT   54    6
CONECT   55   10
CONECT   56   10
CONECT   57   12
CONECT   58   12
CONECT   59   13
CONECT   60   14
CONECT   61   15
CONECT   62   16
CONECT   63   17
CONECT   64   17
CONECT   65   18
CONECT   66   18
CONECT   67   19
CONECT   68   19
CONECT   69   22
CONECT   70   23
CONECT   71   23
CONECT   72   23
CONECT   73   25
CONECT   74   25
CONECT   75   25
CONECT   76   26
CONECT   77   26
CONECT   78   26
CONECT   79   27
CONECT   80   27
CONECT   81   31
CONECT   82   31
CONECT   83   31
CONECT   84   32
CONECT   85   32
CONECT   86   32
CONECT   87   35
CONECT   88   35
CONECT   89   40
CONECT   90   40
CONECT   91   42
CONECT   92   42
CONECT   93   42
CONECT   94   43
CONECT   95   44
CONECT   96   48
CONECT   97   48
CONECT   98   48
MASTER        0    0    0    0    0    0    0    0   98    0   98    0
END`
        },
        custom: {
            name: "Custom Molecule",
            description: "Enter your own molecular data in PDB, MOL2, SDF, XYZ or PQR format.",
            pdb: ""
        }
    };
    
    // Initialize the molecule viewer on page load
    document.addEventListener('DOMContentLoaded', function() {
        initializeViewer();
        setupEventListeners();
        
        // Load default molecule
        loadMolecule('psilocybin');
    });
    
    function initializeViewer() {
        // Initialize the main viewer
        let element = document.getElementById('molecule-viewer');
        viewer = $3Dmol.createViewer(element, {
            backgroundColor: 'white',
            antialias: true,
            outline: true
        });
        
        // Initialize the fullscreen viewer
        let fsElement = document.getElementById('fullscreen-molecule-viewer');
        fullscreenViewer = $3Dmol.createViewer(fsElement, {
            backgroundColor: 'white',
            antialias: true,
            outline: true
        });
    }
    
    function setupEventListeners() {
        // Background color picker
        document.getElementById('backgroundColorPicker').addEventListener('change', function(e) {
            let color = e.target.value;
            viewer.setBackgroundColor(color);
            viewer.render();
        });
        
        // Show atom labels switch
        document.getElementById('showLabelsSwitch').addEventListener('change', function(e) {
            showLabels = e.target.checked;
            if (currentMolecule) {
                updateStyle();
            }
        });
        
        // Spin switch
        document.getElementById('spinSwitch').addEventListener('change', function(e) {
            if (e.target.checked) {
                viewer.spin(true);
            } else {
                viewer.spin(false);
            }
        });
        
        // Reset view button
        document.getElementById('resetViewBtn').addEventListener('click', function() {
            viewer.zoomTo();
            viewer.render();
        });
        
        // Download image button
        document.getElementById('downloadImgBtn').addEventListener('click', function() {
            let imgData = viewer.pngURI();
            let link = document.createElement('a');
            link.href = imgData;
            link.download = `molecule-${currentMolecule.name || 'view'}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // Fullscreen button
        document.getElementById('fullscreenBtn').addEventListener('click', function() {
            let modal = new bootstrap.Modal(document.getElementById('fullscreenModal'));
            modal.show();
            
            // Reset and setup the fullscreen viewer
            fullscreenViewer.clear();
            fullscreenViewer.setBackgroundColor(document.getElementById('backgroundColorPicker').value);
            
            if (currentMolecule && currentMolecule.pdb) {
                fullscreenViewer.addModel(currentMolecule.pdb, "pdb");
                setStyleForViewer(fullscreenViewer, currentStyle);
                fullscreenViewer.zoomTo();
                fullscreenViewer.render();
            }
        });
        
        // Load custom molecule button
        document.getElementById('loadCustomMoleculeBtn').addEventListener('click', function() {
            let format = document.getElementById('moleculeFormat').value;
            let data = document.getElementById('moleculeInput').value.trim();
            
            if (!data) {
                alert('Please enter molecule data or fetch from PDB.');
                return;
            }
            
            moleculeData.custom.pdb = data;
            loadMolecule('custom');
        });
        
        // Fetch PDB button
        document.getElementById('fetchPdbBtn').addEventListener('click', function() {
            let pdbId = document.getElementById('moleculePdbId').value.trim();
            if (!pdbId) {
                alert('Please enter a valid PDB ID.');
                return;
            }
            
            document.getElementById('loading-spinner').classList.remove('d-none');
            
            // Using 3Dmol.js built-in PDB fetcher
            $3Dmol.download("pdb:" + pdbId, function(data) {
                if (data) {
                    document.getElementById('moleculeInput').value = data;
                    document.getElementById('moleculeFormat').value = 'pdb';
                    document.getElementById('loading-spinner').classList.add('d-none');
                    
                    // Auto-load the fetched molecule
                    moleculeData.custom.pdb = data;
                    moleculeData.custom.name = `PDB: ${pdbId.toUpperCase()}`;
                    loadMolecule('custom');
                } else {
                    alert('Failed to fetch PDB data. Please check the ID and try again.');
                    document.getElementById('loading-spinner').classList.add('d-none');
                }
            });
        });
    }
    
    function loadMolecule(moleculeId) {
        // Show loading spinner
        document.getElementById('loading-spinner').classList.remove('d-none');
        
        currentMolecule = moleculeData[moleculeId];
        
        if (!currentMolecule || !currentMolecule.pdb) {
            if (moleculeId === 'custom') {
                alert('Please enter valid molecule data first.');
            } else {
                alert('Molecule data not available.');
            }
            document.getElementById('loading-spinner').classList.add('d-none');
            return;
        }
        
        // Update molecule info
        document.getElementById('molecule-title').textContent = currentMolecule.name || 'Molecular Viewer';
        
        // Clear existing model
        viewer.clear();
        
        try {
            // Add the new model based on the format
            let format = 'pdb';
            if (moleculeId === 'custom') {
                format = document.getElementById('moleculeFormat').value;
            }
            
            viewer.addModel(currentMolecule.pdb, format);
            updateStyle();
            viewer.zoomTo();
            viewer.render();
            
            // Update molecule info
            updateMoleculeInfo();
            
            // Hide loading spinner
            document.getElementById('loading-spinner').classList.add('d-none');
        } catch (e) {
            console.error("Error loading molecule:", e);
            alert("Error loading molecule: " + e.message);
            document.getElementById('loading-spinner').classList.add('d-none');
        }
    }
    
    function updateMoleculeInfo() {
        let infoHtml = '';
        
        if (currentMolecule) {
            infoHtml += `<h5>${currentMolecule.name || 'Unknown Compound'}</h5>`;
            
            if (currentMolecule.formula) {
                infoHtml += `<p><strong>Formula:</strong> ${currentMolecule.formula}</p>`;
            }
            
            if (currentMolecule.mw) {
                infoHtml += `<p><strong>Molecular Weight:</strong> ${currentMolecule.mw} g/mol</p>`;
            }
            
            if (currentMolecule.description) {
                infoHtml += `<p>${currentMolecule.description}</p>`;
            }
            
            if (currentMolecule.smiles) {
                infoHtml += `<p><strong>SMILES:</strong> <span class="font-monospace">${currentMolecule.smiles}</span></p>`;
            }
        } else {
            infoHtml = '<p class="text-center text-muted">No molecule information available</p>';
        }
        
        document.getElementById('molecule-info').innerHTML = infoHtml;
    }
    
    function setStyle(style) {
        currentStyle = style;
        updateStyle();
    }
    
    function updateStyle() {
        setStyleForViewer(viewer, currentStyle);
    }
    
    function setStyleForViewer(viewerInstance, style) {
        let showLabelsValue = document.getElementById('showLabelsSwitch').checked;
        
        viewerInstance.setStyle({}, {cartoon: {}});  // Reset style
        
        if (style === 'stick') {
            viewerInstance.setStyle({}, {stick: {radius: 0.2, colorscheme: 'cyanCarbon'}, cartoon: {color: 'spectrum'}});
        } else if (style === 'sphere') {
            viewerInstance.setStyle({}, {sphere: {scale: 0.3, colorscheme: 'cyanCarbon'}, cartoon: {color: 'spectrum'}});
        } else if (style === 'cartoon') {
            viewerInstance.setStyle({}, {cartoon: {color: 'spectrum', thickness: 0.2, arrows: true}});
        } else if (style === 'line') {
            viewerInstance.setStyle({}, {line: {colorscheme: 'cyanCarbon'}, cartoon: {color: 'spectrum'}});
        } else if (style === 'cross') {
            viewerInstance.setStyle({}, {cross: {colorscheme: 'cyanCarbon'}, cartoon: {color: 'spectrum'}});
        }
        
        // Add atom labels if enabled
        if (showLabelsValue) {
            viewerInstance.addLabels({
                  font: 'sans-serif',
                  fontSize: 12,
                  fontColor: 'black',
                  showBackground: false,
                  alignment: 'center'
                });
        }
        
        viewerInstance.render();
    }
</script>
{% endblock %}